# WordPress on AWS (ECS/Fargate) â€” Terraform

This project deploys **WordPress using containers** on **AWS ECS Fargate** with:

- Autoscaling
- Shared persistent storage for uploads
- Managed database
- Email notifications on failures
- Cost optimization for variable load


---

## Architecture Overview

### Components

**Ingress**
- Application Load Balancer (HTTP/80)

**Compute**
- ECS Cluster with Fargate
- Fargate Spot used as primary capacity provider
- On-Demand Fargate as fallback

**State**
- EFS mounted at `/var/www/html/wp-content`
- Aurora MySQL Serverless v2 (private subnets)

**Observability & Alerts**
- CloudWatch Logs for containers
- CloudWatch Alarms
- EventBridge rules
- SNS topic with email subscription

---

## Cost Optimization Strategy

The infrastructure minimizes fixed costs while supporting load spikes:

1. **Fargate Spot-first**
   - Significantly cheaper compute for non-critical stateless workloads
2. **No NAT Gateway**
   - ECS tasks run in public subnets with public IPs
   - Inbound traffic restricted strictly to ALB security group
3. **Aurora Serverless v2**
   - Database capacity scales automatically within ACU limits
4. **EFS Lifecycle Policy**
   - Files transition to Infrequent Access after 14 days

This keeps baseline monthly cost low while allowing horizontal scaling.

---

## Prerequisites

- Terraform >= 1.5
- AWS account
- AWS credentials configured locally (IAM user, role, or SSO)
- Permissions to create:
  - VPC, ECS, ALB
  - EFS, RDS (Aurora)
  - IAM roles and policies
  - CloudWatch, SNS, EventBridge
  - Secrets Manager

---

## Repository Structure

```text
terraform/
  versions.tf
  providers.tf
  variables.tf
  main.tf
  outputs.tf

  modules/
    network/
    efs/
    database/
    ecs_wordpress/
    alerts/
```

## Cost Optimization Strategy

The infrastructure minimizes fixed costs while supporting load spikes:

1. **Fargate Spot-first**
   - Significantly cheaper compute for non-critical stateless workloads
2. **No NAT Gateway**
   - ECS tasks run in public subnets with public IPs
   - Inbound traffic restricted strictly to ALB security group
3. **Aurora Serverless v2**
   - Database capacity scales automatically within ACU limits
4. **EFS Lifecycle Policy**
   - Files transition to Infrequent Access after 14 days

This keeps baseline monthly cost low while allowing horizontal scaling.

---